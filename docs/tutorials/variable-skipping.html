<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Skipping of Questions in NHANES – NHANES Tutorials</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-de4de07f82120c2cab44c9d2883d6f16.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-fc69c27516b785ffb5db61c6a6e66aa6.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.18/datatables.js"></script>
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">NHANES Tutorials</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./nhanes-introduction.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./nhanes-local.html"> 
<span class="menu-text">Local Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./bmi-over-cycles.html"> 
<span class="menu-text">BMI Over Time</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./variable-skipping.html" aria-current="page"> 
<span class="menu-text">Variable Skipping</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#the-smoking-survey" id="toc-the-smoking-survey" class="nav-link" data-scroll-target="#the-smoking-survey">The Smoking survey</a></li>
  </ul></li>
  <li><a href="#why-is-this-important" id="toc-why-is-this-important" class="nav-link" data-scroll-target="#why-is-this-important">Why is this important?</a></li>
  <li><a href="#identifying-skipped-questions" id="toc-identifying-skipped-questions" class="nav-link" data-scroll-target="#identifying-skipped-questions">Identifying skipped questions</a></li>
  <li><a href="#another-example-blood-pressure-by-age" id="toc-another-example-blood-pressure-by-age" class="nav-link" data-scroll-target="#another-example-blood-pressure-by-age">Another example: Blood Pressure by Age</a></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information">Session information</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Skipping of Questions in NHANES</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The NHANES data set provides a large diverse set of data to study health and other sociological and epidemiological topics on the US population. In this vignette we discuss some challenges that arise due to the manner in which the survey is deployed and delivered.</p>
<p>In many situations a survey will be designed to have some form of branching logic. The logic is typically triggered off of the response to one question and designed to ensure that questions that are no longer relevant for the interviewee are not asked. We will use the smoking cigarettes survey <code>SMQ</code> for cycle J (2017–2018) as the basis for our discussion, since it makes rather heavy use of branching, which we will also refer to as skipping.</p>
<section id="the-smoking-survey" class="level3">
<h3 class="anchored" data-anchor-id="the-smoking-survey">The Smoking survey</h3>
<div id="fig-smq" class="lightbox quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-smq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="screenshots/smoking-age.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: Questions SMQ020 and SMD030"><img src="screenshots/smoking-age.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-smq-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Questions SMQ020 and SMD030
</figcaption>
</figure>
</div>
<p>In <a href="#fig-smq" class="quarto-xref">Figure&nbsp;1</a> we see the documentation for two questions in the 2017–2018 survey. First, participants were asked the question <code>SMQ020</code>, whether or not they had smoked 100 cigarettes in their life. Those that said <strong>Yes</strong> were asked the question <code>SMD030</code>, at what age did they being smoking. Anyone who responded <strong>No</strong> to <code>SMQ020</code> skipped over <code>SMD030</code> and a number of other questions about smoking and cigarettes. The goal is to make the survey less onerous for those people, as there were over 20 questions skipped and someone who had never smoked would probably not have answers to those questions.</p>
<p>We next consider the table for <code>SMD030</code>. Of the 2359 people who answered <strong>Yes</strong> to <code>SMQ020</code>, 2285 gave an age (in years), 62 said that they never really smoked regularly, and 12 responded that they did not know. The 3497 people who answered <strong>No</strong> to <code>SMQ020</code> were recorded as <strong>Missing</strong> for question <code>SMD030</code>. An additional 868 people, who <em>were</em> asked question <code>SMD030</code>, also had <strong>Missing</strong> entered for their response, for a total of 4365 people recorded as having a missing response for <code>SMD030</code>.</p>
<p>This is a common practice throughout the NHANES survey. Whenever a question is skipped for a participant, the response is recorded as <strong>Missing</strong>. However, <strong>Missing</strong> is also a possible response for participants who <em>were</em> asked a question. The only way to distinguish between these two very different types of missingness is to consider the responses to preceding questions to determine whether or not the question was actually asked to a particular participant.</p>
<p>Now, when we analyze this data we will need to think carefully about how to deal with the data in <code>SMD030</code>. If we are analyzing smokers only, then the skipping is not an issue. But if we want to study obesity, for example, and we want to include smoking behavior as a predictor, we will want to be careful about using <code>SMD030</code>. If we use it without doing any preprocessing, then most modeling software, such as <code>lm</code> or <code>glm</code> in R, will simply remove any case (person) who has a missing value in any of their covariates. That would be quite devestating to our analysis and would in some sense invalidate it, since in that scenario only smokers would end up in the final model.</p>
<p>So, if we want to keep information on smoking in our model and we want to use the age at which someone started smoking in our analysis, then we need to find some way to encode <code>SMD030</code> that does not use missing values. One choice is to set the age at which they started smoking to be their current age. Using that value one can determine the number of years they smoked by subtracting the age at which they started from their current age. For the nonsmokers this would then be 0 (zero). One could also entertain the use of survival analysis techniques with that definition. For non-smokers, we don’t know if they will start smoking in the future, but we do know that they have not started by their current age.</p>
<p>Our goal in the remainder of this article is to describe tools that can help analysts easily identify any skipping behavior. The question of how to appropriately remediate skipping is potentially very complicated, and cannot easily be automated.</p>
</section>
</section>
<section id="why-is-this-important" class="level2">
<h2 class="anchored" data-anchor-id="why-is-this-important">Why is this important?</h2>
<p>Ensuring that you appropriately address skipping is going to be important for any analysis. Failing to address this issue can lead to decreased power, since you may drop out of your analysis observations that you did not need to. Fewer individuals generally leads to less power.</p>
<p>It can also lead to bias. Returning to the example above, if we do not address the missing values that were inserted into <code>SMD030</code> then any analysis that includes that variable could result in all non-smokers being removed, as most modeling functions require complete cases. Consequently, our estimates would be applicable only to smokers, and not, as we were hoping, to the whole population.</p>
</section>
<section id="identifying-skipped-questions" class="level2">
<h2 class="anchored" data-anchor-id="identifying-skipped-questions">Identifying skipped questions</h2>
<p>The <code>get_skip_info()</code> function in the <strong>phonto</strong> package can be used to identify questions that were potentially skipped based on answers to previous questions in the same table. Here we use it to get the skipping information for table <code>SMQ_J</code>.</p>
<p>Each row in the returned data frame corresponds to a question in the survey. By default, <code>get_skip_info()</code> returns a data frame with one row for each question in the survey. It does not include a row for <code>SEQN</code>, so it is not quite the number of columns in the data.</p>
<p>We assume that the questions were given in the order that they are presented in the metadata HTML page. This allows us to identify, for each question, whether it might have been skipped, and if it was, which of the previous questions in the survey might have caused the skipping (the <code>SkippedDueTo</code> column). As you will note on examining that ouput, there are some questions that might be skipped due to a fairly large number of previous questions, others that are never skipped, and some that are skipped just due to one question.</p>
<p>This complexity is challenging to interpret and it is likely that analysts will need to be quite careful in determining what, if anything, needs to be done in order to obtain an appropriate analysis of the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>gg <span class="ot">=</span> <span class="fu">get_skip_info</span>(<span class="st">"SMQ_J"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(gg, <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="st">"50"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-0d7f1e2181760dc9704e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0d7f1e2181760dc9704e">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37"],["SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J","SMQ_J"],["SEQN","SMQ020","SMD030","SMQ040","SMQ050Q","SMQ050U","SMD057","SMQ078","SMD641","SMD650","SMD093","SMDUPCA","SMD100BR","SMD100FL","SMD100MN","SMD100LN","SMD100TR","SMD100NI","SMD100CO","SMQ621","SMD630","SMQ661","SMQ665A","SMQ665B","SMQ665C","SMQ665D","SMQ670","SMQ848","SMQ852Q","SMQ852U","SMQ890","SMQ895","SMQ900","SMQ905","SMQ910","SMQ915","SMAQUEX2"],[false,false,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,false],["","","SMQ020","SMQ020","SMQ020, SMQ040","SMQ020, SMQ040","SMQ020, SMQ040","SMQ020, SMQ040","SMQ020, SMQ040","SMQ020, SMQ040","SMQ020, SMQ040","SMQ020, SMQ040, SMD093","SMQ020, SMQ040, SMD093","SMQ020, SMQ040, SMD093","SMQ020, SMQ040, SMD093","SMQ020, SMQ040, SMD093","SMQ020, SMQ040, SMD093","SMQ020, SMQ040, SMD093","SMQ020, SMQ040, SMD093","SMQ020, SMQ040, SMD093","SMQ020, SMQ621, SMQ040, SMD093","SMQ020, SMQ621, SMD630, SMQ040, SMD093","SMQ020, SMQ621, SMD630, SMQ661, SMQ040, SMD093","SMQ020, SMQ621, SMD630, SMQ661, SMQ040, SMD093, SMQ665A","SMQ020, SMQ621, SMD630, SMQ661, SMQ040, SMD093, SMQ665A, SMQ665B","SMQ020, SMQ621, SMD630, SMQ661, SMQ040, SMD093, SMQ665A, SMQ665B, SMQ665C","SMQ020, SMQ621, SMD630, SMQ040","SMQ020, SMQ621, SMD630, SMQ040","SMQ020, SMQ621, SMD630, SMQ040","SMQ020, SMQ621, SMD630, SMQ040","SMQ621, SMD630, SMQ040","SMQ621, SMD630, SMQ040, SMQ890","SMQ621, SMD630, SMQ040","SMQ621, SMD630, SMQ040, SMQ900","SMQ621, SMD630, SMQ040","SMQ621, SMD630, SMQ040, SMQ910",""]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Table<\/th>\n      <th>Variable<\/th>\n      <th>MaybeSkipped<\/th>\n      <th>SkippedDueTo<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":"50","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}],"lengthMenu":["10","100","25","50"]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="another-example-blood-pressure-by-age" class="level2">
<h2 class="anchored" data-anchor-id="another-example-blood-pressure-by-age">Another example: Blood Pressure by Age</h2>
<p>We illustrate the importance of taking skipping information into account using another example involving blood pressure. In this case, once the skipping issue is identified, resolving it is fairly straightforward. However, a failure to identify the issue in the first place would result in informative observations being dropped from the analysis, leading to loss of power and very likely biased estimates.</p>
<p>Hypertension is an important metric of overall health that generally worsens with age. One may be interested in knowing how the distribution of blood pressure changes with age, so that guidelines regarding it may be tuned accordingly.</p>
<p>The <code>BPX</code> data and its analogues in other cycles measure blood pressure related variables. In the analysis below, we combine the <code>BPXSY1</code> variable (the first reading of systolic blood pressure) with age and gender to estimate how average systolic blood pressure changes with age. We restrict our analysis to the Non-Hispanic White subpopulation.</p>
<p>First we combine the relevant data from the two tables from the first ten cycles, using the <code>jointQuery()</code> function in the <strong>phonto</strong> package to efficiently extract and combine the data using database operations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>demo_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"RIDAGEYR"</span>, <span class="st">"RIAGENDR"</span>, <span class="st">"RIDRETH1"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>demo_tables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DEMO"</span>, <span class="st">"DEMO_B"</span>, <span class="st">"DEMO_C"</span>, <span class="st">"DEMO_D"</span>, <span class="st">"DEMO_E"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"DEMO_F"</span>, <span class="st">"DEMO_G"</span>, <span class="st">"DEMO_H"</span>, <span class="st">"DEMO_I"</span>, <span class="st">"DEMO_J"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>demo_list <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(demo_vars), <span class="fu">length</span>(demo_tables))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(demo_list) <span class="ot">&lt;-</span> demo_tables</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>bpx_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BPXSY1"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>bpx_tables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BPX"</span>, <span class="st">"BPX_B"</span>, <span class="st">"BPX_C"</span>, <span class="st">"BPX_D"</span>, <span class="st">"BPX_E"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"BPX_F"</span>, <span class="st">"BPX_G"</span>, <span class="st">"BPX_H"</span>, <span class="st">"BPX_I"</span>, <span class="st">"BPX_J"</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>bpx_list <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(bpx_vars), <span class="fu">length</span>(bpx_tables))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bpx_list) <span class="ot">&lt;-</span> bpx_tables</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(df1 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(<span class="fu">c</span>(demo_list, bpx_list)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  2.231   0.147   6.225 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(df1, RIDAGEYR <span class="sc">&gt;</span> <span class="dv">20</span> <span class="sc">&amp;</span> RIDRETH1 <span class="sc">==</span> <span class="st">"Non-Hispanic White"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To see how the distribution of systolic blood pressure changes with age, we plot the data in <a href="#fig-bpage" class="quarto-xref">Figure&nbsp;2</a> along with a nonparametric LOESS smooth.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(BPXSY1 <span class="sc">~</span> RIDAGEYR <span class="sc">|</span> RIAGENDR, df1, <span class="at">grid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span> <span class="fu">layer</span>(<span class="fu">panel.loess</span>(x, y, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"grey20"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-bpage" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bpage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="variable-skipping_files/figure-html/fig-bpage-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;2: Plot of systolic blood pressure by age and gender along with LOESS smooth"><img src="variable-skipping_files/figure-html/fig-bpage-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bpage-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Plot of systolic blood pressure by age and gender along with LOESS smooth
</figcaption>
</figure>
</div>
</div>
</div>
<p>As we are interested primarily in the estimated regression smooth, we can remove the distraction of the actual data points. <a href="#fig-bpage-smooth" class="quarto-xref">Figure&nbsp;3</a> shows only the LOESS smooth, making it easier to see the changes in average systolic blood pressure, and compare white males and white females.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(BPXSY1 <span class="sc">~</span> RIDAGEYR <span class="sc">|</span> RIAGENDR, df1, <span class="at">grid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">extendrange</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">160</span>)), <span class="at">type =</span> <span class="st">"smooth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-bpage-smooth" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bpage-smooth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="variable-skipping_files/figure-html/fig-bpage-smooth-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;3: LOESS smooth of systolic blood pressure by age and gender"><img src="variable-skipping_files/figure-html/fig-bpage-smooth-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bpage-smooth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: LOESS smooth of systolic blood pressure by age and gender
</figcaption>
</figure>
</div>
</div>
</div>
<p>These plots suggest that on average, systolic blood pressure increases with age, but the rate of increase is significantly higher for females, who start with lower values than males but end up with higher values. Also, interestingly, the growth is more or less linear for both genders, with a change in the rate of change (slope) around age 40.</p>
<p>Of course, any interpretation of these blood pressure measurements must take into account other covariates that may affect blood pressure. The most obvious one we may want to consider is whether the person being studied is taking any blood pressure lowering medication. This information is recorded in another set of tables starting with <code>BPQ</code>, which records responses to interview questions related to blood pressure. The question that is most directly relevant is</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nhanesCodebook</span>(<span class="st">"BPQ_C"</span>)<span class="sc">$</span>BPQ050A</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`Variable Name:`
[1] "BPQ050A"

$`SAS Label:`
[1] "Now taking prescribed medicine"

$`English Text:`
[1] "HELP AVAILABLE (Are you/Is SP) now taking prescribed medicine"

$`Target:`
[1] "Both males and females 16 YEARS - 150 YEARS"

$BPQ050A
# A tibble: 5 × 5
  Code.or.Value Value.Description Count Cumulative Skip.to.Item
  &lt;chr&gt;         &lt;chr&gt;             &lt;int&gt;      &lt;int&gt; &lt;chr&gt;       
1 1             Yes                1291       1291 &lt;NA&gt;        
2 2             No                  160       1451 &lt;NA&gt;        
3 7             Refused               0       1451 &lt;NA&gt;        
4 9             Don't know            1       1452 &lt;NA&gt;        
5 .             Missing            4761       6213 &lt;NA&gt;        </code></pre>
</div>
</div>
<p>However, a response of <strong>Mising</strong> for this question does not necessarily mean that information is unavailable. The following code tells us that this question may have been skipped depending on the response to two previous questions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_skip_info</span>(<span class="st">"BPQ_C"</span>) <span class="sc">|&gt;</span> <span class="fu">subset</span>(Variable <span class="sc">==</span> <span class="st">"BPQ050A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Table Variable MaybeSkipped   SkippedDueTo
17 BPQ_C  BPQ050A         TRUE BPQ010, BPQ020</code></pre>
</div>
</div>
<p>These questions are</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nhanesCodebook</span>(<span class="st">"BPQ_C"</span>)<span class="sc">$</span>BPQ010<span class="sc">$</span><span class="st">`</span><span class="at">SAS Label:</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Last blood pressure reading by doctor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nhanesCodebook</span>(<span class="st">"BPQ_C"</span>)<span class="sc">$</span>BPQ020<span class="sc">$</span><span class="st">`</span><span class="at">SAS Label:</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ever told you had high blood pressure"</code></pre>
</div>
</div>
<p>More details regarding the number of participants for whom <code>BPQ050A</code> was skipped in a particular cycle is available in the corresponding codebooks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nhanesCodebook</span>(<span class="st">"BPQ_C"</span>)<span class="sc">$</span>BPQ010<span class="sc">$</span>BPQ010</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  Code.or.Value Value.Description                Count Cumulative Skip.to.Item
  &lt;chr&gt;         &lt;chr&gt;                            &lt;int&gt;      &lt;int&gt; &lt;chr&gt;       
1 1             Less than 6 months ago,           4412       4412 ""          
2 2             6 months to 1 year ago,            868       5280 ""          
3 3             More than 1 year to 2 years ago,   434       5714 ""          
4 4             More than 2 years ago, or          411       6125 ""          
5 5             Never?                              75       6200 "BPQ055"    
6 7             Refused                              0       6200 "BPQ055"    
7 9             Don't know                          13       6213 ""          
8 .             Missing                              0       6213 ""          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nhanesCodebook</span>(<span class="st">"BPQ_C"</span>)<span class="sc">$</span>BPQ020<span class="sc">$</span>BPQ020</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  Code.or.Value Value.Description Count Cumulative Skip.to.Item
  &lt;chr&gt;         &lt;chr&gt;             &lt;int&gt;      &lt;int&gt; &lt;chr&gt;       
1 1             Yes                1801       1801 ""          
2 2             No                 4319       6120 "BPQ055"    
3 7             Refused               0       6120 "BPQ055"    
4 9             Don't know           18       6138 "BPQ055"    
5 .             Missing              75       6213 ""          </code></pre>
</div>
</div>
<p>It is clear, once we compare the numbers in the three tables, that most of the the <strong>Missing</strong> values in <code>BPQ050A</code> (4319 out of 4761) are because this question was skipped for individuals who have never been diagnosed with high blood pressure. The other variable <code>BPQ010</code> has a relatively minor impact. Assuming that these trends are representative of all cycles, and in the interest of keeping our example simple, we will proceed with our analysis by incorporating the additional information contained in <code>BPQ020</code> (while ignoring <code>BPQ010</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>bpq_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BPQ020"</span>, <span class="st">"BPQ050A"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>bpq_tables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BPQ"</span>, <span class="st">"BPQ_B"</span>, <span class="st">"BPQ_C"</span>, <span class="st">"BPQ_D"</span>, <span class="st">"BPQ_E"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">"BPQ_F"</span>, <span class="st">"BPQ_G"</span>, <span class="st">"BPQ_H"</span>, <span class="st">"BPQ_I"</span>, <span class="st">"BPQ_J"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>bpq_list <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(bpq_vars), <span class="fu">length</span>(bpq_tables))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bpq_list) <span class="ot">&lt;-</span> bpq_tables</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(df2 <span class="ot">&lt;-</span> <span class="fu">jointQuery</span>(<span class="fu">c</span>(demo_list, bpx_list, bpq_list)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  3.121   0.221   8.995 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(df2, RIDAGEYR <span class="sc">&gt;</span> <span class="dv">20</span> <span class="sc">&amp;</span> RIDRETH1 <span class="sc">==</span> <span class="st">"Non-Hispanic White"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After regenerating our dataset to include the additional variables, we create a new derived variable that records our best guess regarding whether a participant is currently taking blood pressure lowering medication, interpreting any ambiguous information as missing data, which will be excluded from the analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(df2,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">NoBPMed =</span> BPQ020 <span class="sc">==</span> <span class="st">"No"</span> <span class="sc">|</span> BPQ050A <span class="sc">==</span> <span class="st">"No"</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">BPMed =</span> <span class="fu">ifelse</span>(NoBPMed, <span class="st">"No"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">ifelse</span>(BPQ050A <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="st">"Yes"</span>, <span class="cn">NA_character_</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, <a href="#fig-bpage-smooth-med" class="quarto-xref">Figure&nbsp;4</a> compares the LOESS smooths of systolic blood pressure by age and gender separately for those who are taking blood pressure lowering medication and those who are not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(BPXSY1 <span class="sc">~</span> RIDAGEYR <span class="sc">|</span> RIAGENDR, df2, <span class="at">grid =</span> <span class="cn">TRUE</span>, <span class="at">groups =</span> BPMed,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Taking BP Medicine"</span>, <span class="at">columns =</span> <span class="dv">2</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">lines =</span> <span class="cn">TRUE</span>, <span class="at">points =</span> <span class="cn">FALSE</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">"Age in years"</span>, <span class="at">ylab =</span> <span class="st">"Systolic blood pressure"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">extendrange</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">160</span>)), <span class="at">type =</span> <span class="st">"smooth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-bpage-smooth-med" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-bpage-smooth-med-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="variable-skipping_files/figure-html/fig-bpage-smooth-med-1.svg" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure&nbsp;4: LOESS smooth of systolic blood pressure by age and gender, separately for those who take blood pressure lowering medication and those who do not."><img src="variable-skipping_files/figure-html/fig-bpage-smooth-med-1.svg" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-bpage-smooth-med-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: LOESS smooth of systolic blood pressure by age and gender, separately for those who take blood pressure lowering medication and those who do not.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Somewhat counterintutively, those who are taking medication still have significantly higher blood pressure than those who are not. We can interpret this as meaning that hypertension is generally diagnosed and treated in a timely manner, but that treatment does not appear to be enough to bring back the blood pressure levels at par with those not treated.</p>
<p>There are other interesting features of the plot that we will not delve into further. Of course, a more nuanced analysis will need to look at confidence bands for these smooths, possibly incorporate other covariates, and also take into account that these data from a complex survey cannot be treated as a simple random sample as we have done.</p>
</section>
<section id="session-information" class="level1">
<h1>Session information</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sessionInfo</span>(), <span class="at">locale =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R Under development (unstable) (2025-04-06 r88113)
Platform: x86_64-apple-darwin22.2.0
Running under: macOS Ventura 13.1

Matrix products: default
BLAS:   /usr/local/Cellar/openblas/0.3.29/lib/libopenblasp-r0.3.29.dylib 
LAPACK: /Users/deepayan/local/lib/R/lib/libRlapack.dylib;  LAPACK version 3.12.1

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] latticeExtra_0.6-30 lattice_0.22-7      DT_0.18            
[4] phonto_0.3.4        nhanesA_1.3         knitr_1.43         

loaded via a namespace (and not attached):
 [1] utf8_1.1.4         sass_0.4.8         generics_0.1.3     xml2_1.3.2        
 [5] jpeg_0.1-10        stringi_1.5.3      hms_1.1.3          digest_0.6.34     
 [9] magrittr_2.0.3     evaluate_0.21      grid_4.6.0         timechange_0.2.0  
[13] RColorBrewer_1.1-2 fastmap_1.1.0      blob_1.2.4         plyr_1.8.6        
[17] jsonlite_1.8.8     RPostgres_1.4.6    DBI_1.2.2          httr_1.4.2        
[21] rvest_1.0.3        purrr_1.0.2        crosstalk_1.1.1    codetools_0.2-20  
[25] jquerylib_0.1.4    cli_3.6.2          rlang_1.1.3        dbplyr_2.5.0      
[29] bit64_4.0.5        cachem_1.0.4       withr_2.5.0        yaml_2.2.1        
[33] tools_4.6.0        deldir_1.0-6       dplyr_1.1.4        interp_1.1-4      
[37] vctrs_0.6.5        R6_2.5.1           png_0.1-7          lifecycle_1.0.3   
[41] lubridate_1.9.3    stringr_1.5.1      htmlwidgets_1.5.3  bit_4.0.5         
[45] foreign_0.8-90     pkgconfig_2.0.3    bslib_0.6.1        pillar_1.10.0     
[49] glue_1.6.2         Rcpp_1.0.10        xfun_0.49          tibble_3.2.1      
[53] tidyselect_1.2.1   rstudioapi_0.13    htmltools_0.5.7    rmarkdown_2.26    
[57] compiler_4.6.0    </code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>